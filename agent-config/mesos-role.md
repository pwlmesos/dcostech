# Mesos Resource Role

How to set resources for reservation for use by a particular app.

## Problem:

A customer wants to reserve specific resources for an app on particular nodes. Attributes can be used to target a specific set of nodes, but it doesn't ensure resources are reserved for an app.

## Setting Resources

You will need to define the resources you want to reserve and any that it requires to schedule the the task to include CPU, MEM, DISK, PORTS 

Alter the mesos-resources file.

```bash
sudo vim /var/lib/dcos/mesos-resources
```

The following values will be added for this example

CPUS

```json
{
    "name": "cpus", 
    "type": "SCALAR", 
    "role": "example",
    "scalar": {"value": 2}
}
```

MEM

```json
{
    "name": "mem", 
    "type": "SCALAR", 
    "role": "example",
    "scalar": {"value": 954}
}
```

Ports

```json
{
    "name": "ports", 
    "type": "RANGES", 
    "role": "example",
    "ranges": {
        "range": [{"begin": 8185, "end": 8189}]
    }
}
```

In the end the new /var/lib/dcos/mesos-resources file should look like the following

```bash
Generated by make_disk_resources.py on 2020-05-11 17:39:17.601477

MESOS_RESOURCES='[{"name": "mem", "type": "SCALAR", "role": "example","scalar": {"value": 954}},{"name": "cpus", "type": "SCALAR", "role": "example","scalar": {"value": 2}},{"name": "ports", "type": "RANGES", "role": "example","ranges": {"range": [{"begin": 8185, "end": 8189}]}}]'
```

This will make all resources on the machine owned by the example role, if default role, '*', resources are still needed then they need entered like the above example role, the default assumption of resources will be overwritten.

```bash
# Generated by make_disk_resources.py on 2020-05-11 17:39:17.601477
#

MESOS_RESOURCES='[{"name": "ports", "type": "RANGES", "ranges": { "range": [ {"begin": 1025, "end": 2180},{"begin": 2182, "end": 3887},{"begin": 3889, "end": 5049},{"begin": 5052, "end": 8079},{"begin": 8082, "end": 8180},{"begin": 8190, "end": 32000}]}}, {"name": "disk", "role": "*", "scalar": {"value": 118724}, "type": "SCALAR"},{"name": "cpus", "type": "SCALAR", "role": "*","scalar": {"value": 2}},{"name": "mem", "type": "SCALAR", "role": "*","scalar": {"value": 954}},{"name": "ports", "type": "RANGES", "role": "restricted","ranges": {"range": [{"begin": 8185, "end": 8189}]}},{"name": "cpus", "type": "SCALAR", "role": "restricted","scalar": {"value": 2}},{"name": "mem", "type": "SCALAR", "role": "restricted","scalar": {"value": 954}},'
```

Easier to read values of mesos resources

```json
{
    "name": "ports",
    "type": "RANGES",
    "ranges": {
        "range": [
            {
                "begin": 1025,
                "end": 2180
            },
            {
                "begin": 2182,
                "end": 3887
            },
            {
                "begin": 3889,
                "end": 5049
            },
            {
                "begin": 5052,
                "end": 8079
            },
            {
                "begin": 8082,
                "end": 8180
            },
            {
                "begin": 8190,
                "end": 32000
            }
        ]
    }
},
{
    "name": "disk",
    "role": "*",
    "scalar": {
        "value": 118724
    },
    "type": "SCALAR"
},
{
    "name": "cpus",
    "type": "SCALAR",
    "role": "*",
    "scalar": {
        "value": 2
    }
},
{
    "name": "mem",
    "type": "SCALAR",
    "role": "*",
    "scalar": {
        "value": 954
    }
},
{
    "name": "ports",
    "type": "RANGES",
    "role": "example",
    "ranges": {
        "range": [
            {
                "begin": 8185,
                "end": 8189
            }
        ]
    }
},
{
    "name": "cpus",
    "type": "SCALAR",
    "role": "example",
    "scalar": {
        "value": 2
    }
},
{
    "name": "mem",
    "type": "SCALAR",
    "role": "example",
    "scalar": {
        "value": 954
    }
}
```

That will allow other resources to get assigned as needed.

## Marathon

Marathon by default does not accept offers from role restricted, to launch the task we will need to configure a Marathon on Marathon instance to use the "example" role.

!["mesos-role"](img/mesosrole.png)
